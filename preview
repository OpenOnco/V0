#!/bin/bash
# OpenOnco Preview: smoke tests + API tests â†’ push to current branch â†’ Vercel preview
#
# Usage: ./preview [commit message]
# Example: ./preview "Add new test data"

set -e
cd "$(dirname "$0")"

echo "ðŸ§ª Running smoke tests..."
npm run test:smoke

echo ""
echo "ðŸ”Œ Running API tests..."
npm run test:api

echo ""
echo "âœ… Tests passed. Pushing to remote..."
git add -A
git commit -m "${1:-wip: preview}" --allow-empty
git push

BRANCH=$(git rev-parse --abbrev-ref HEAD)

echo ""
echo "ðŸš€ Pushed to '$BRANCH'!"
echo ""
echo "ðŸ“Ž Vercel will automatically deploy a preview."
echo "   Check your PR or the Vercel dashboard for the preview URL."
echo ""
